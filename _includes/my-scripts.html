<!-- <script>
  // This is now implemented in dark-mode-fix.js
  var toggleDarkMode = function(){
    var e = document.body.classList;
    e.contains("dark-mode") || !e.contains("light-mode") && matchMedia("(prefers-color-scheme: dark)").matches ? (e.remove("dark-mode"),
    e.add("light-mode")) : (e.remove("light-mode"),
    e.add("dark-mode"))
  }
  var localTime = new Date();
  if(localTime.getHours() > 18 || localTime.getHours() < 8){
    toggleDarkMode();
  }
</script> -->


<!-- <script type="text/javascript" src="/assets/gabryxx7/js/instafeed.min.js"></script> -->
<!-- I gotta add this here or the javascript will NOT load when dynamic page reloading is disabled
typewriter.js and the code below are not that big so it should not be much of an issue in page loading speed. Especially with jekyll -->

<script src="/assets/gabryxx7/js/jquery-3.5.1.min.js"></script>
<script src="/assets/gabryxx7/js/typewriter.js"></script>
<script>
function appendLeadingZeroes(n){
    if(n <= 9){
      return "0" + n;
    }
    return n;
  };
  function strip(html){
    var doc = new DOMParser().parseFromString(html, 'text/html');
    return doc.body.textContent || "";
  };


var startTyper = function(){
  var typingWindow = document.getElementById('typing-window');
  var app = document.getElementById('typing-area');

  if(!app)
    return;

  var closeBtn =  document.getElementById('typing-close-btn');
  typingWindow.addEventListener('transitionend', () => typingWindow.remove());

  setTimeout (function() {
    closeBtn.classList.toggle('disabled');
    closeBtn.onclick = function() {
          console.log("Btn clicked");
          typewriter.stop();
          typingWindow.style.opacity = 0;
      };
  }, 10000);
  console.log("Starting typer!");

  var totalLoops = 20;
  var wordList = ["<em>PhD Student</em> ðŸ“š", "Programmer ðŸ’»", "Photographer ðŸ“·", "Pizza Lover ðŸ•", "Gamer ðŸ‘¾", "Swimmer ðŸŠ", "Traveller ðŸŒ"];
  var pause = [1000, 4500];
  var terminalStarter = "> <span style='color: #5cd400;'> gabryxx7@blog: </span> ";
  var current_datetime = new Date();
  var formatted_date = current_datetime.getFullYear() + "-" + appendLeadingZeroes(current_datetime.getMonth() + 1) + "-" + appendLeadingZeroes(current_datetime.getDate()) + " " + appendLeadingZeroes(current_datetime.getHours()) + ":" + appendLeadingZeroes(current_datetime.getMinutes()) + ":" + appendLeadingZeroes(current_datetime.getSeconds());

  var randomDelay = function(){
   return Math.random() * (pause[1] - pause[0] + pause[0]);
  };
  var typewriter = new Typewriter(app, {
    loop: false,
    delay: 'natural',
    cursor: 'â–Œ'
  });

  typewriter
  .pasteString(terminalStarter +"["+formatted_date+"]")
  .pauseFor(1000);

  if(current_datetime.getHours() > 22 ||current_datetime.getHours() < 5){
    typewriter
    .changeDelay(50)
    .pasteString("<br /> " +terminalStarter)
    .typeString("What are you doing up late? :)")
    .pauseFor(randomDelay());
  };

  if((current_datetime.getMonth() + 1) == 9 && current_datetime.getDate() == 12){
    typewriter
    .changeDelay(50)
    .pasteString("<br /> " +terminalStarter)
    .typeString("It's my birthday today! ðŸŽ‚ðŸŽ‰")
    .pauseFor(randomDelay());    
  };

  typewriter
  .changeDelay(80)
  .pasteString("<br /> " +terminalStarter)
  .pauseFor(1200)
  .typeString("Hey!")
  .pauseFor(800)
  .typeString(" I'm <strong>Gabriele</strong>")
  .pauseFor(1000)
  .pasteString("<br /> " + terminalStarter)
  .typeString(" I'm a...");

  for(var k = 0; k < totalLoops; k++){ 
    for(var i=0; i < wordList.length; i++){
      typewriter
      .typeString(wordList[i])
      .pauseFor(randomDelay())
      .deleteChars(strip(wordList[i]).length);
    };
  };
  typewriter.start();
};


document.getElementById('_pushState').addEventListener('hy-push-state-load', function() {
    startTyper();
});
</script>